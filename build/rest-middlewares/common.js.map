{"version":3,"sources":["../../lib/rest-middlewares/common.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;QAEG,UAAU,GAAV,UAAU;QAkBV,SAAS,GAAT,SAAS;QAWT,cAAc,GAAd,cAAc;QAuBd,QAAQ,GAAR,QAAQ;;;;AApDjB,SAAS,UAAU,OAAe;MAAb,UAAU,QAAV,UAAU;;AACpC;wDAAO,wBAA6C,IAAI;UAAhC,OAAO,SAAP,OAAO;UAAE,QAAQ,SAAR,QAAQ;UAAE,MAAM,SAAN,MAAM;UAI3C,MAAM;;;;;;AAFV,sBAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,IAAI,EAAE,CAAC;;AAEhC,oBAAM,GAAG,UAAU,CAAC,MAAM;;AAE9B,sBAAQ,CAAC,IAAI,CAAC,MAAM,GAAG;AACrB,oBAAI,EAAE,MAAM,CAAC,IAAI;AACjB,2BAAW,EAAE,MAAM,CAAC,WAAW;AAC/B,0BAAU,EAAE,MAAM,CAAC,UAAU;AAC7B,yBAAS,EAAE,MAAM,CAAC,SAAS;eAC5B,CAAC;;;qBAEI,IAAI,EAAE;;;;;;;;KACb;;;;;OAAA;CACF;;AAEM,SAAS,SAAS,QAAe;MAAb,UAAU,SAAV,UAAU;;AACnC;wDAAO,yBAA6C,IAAI;UAAhC,OAAO,SAAP,OAAO;UAAE,QAAQ,SAAR,QAAQ;UAAE,MAAM,SAAN,MAAM;;;;;;AAE/C,sBAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,IAAI,EAAE,CAAC;;;qBAEE,UAAU,CAAC,KAAK,EAAE;;;AAAxD,sBAAQ,CAAC,IAAI,CAAC,eAAe;;qBAEvB,IAAI,EAAE;;;;;;;;KACb;;;;;OAAA;CACF;;AAEM,SAAS,cAAc,QAAe;MAAb,UAAU,SAAV,UAAU;;AACxC;wDAAO,yBAA6C,IAAI;UAAhC,OAAO,SAAP,OAAO;UAAE,QAAQ,SAAR,QAAQ;UAAE,MAAM,SAAN,MAAM;UAE3C,KAAK,EAIL,KAAK,EAOL,OAAO;;;;;AAXP,mBAAK,GAAG,OAAO,CAAC,KAAK,IAAI,EAAE;;AAE/B,sBAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,IAAI,EAAE,CAAC;;mBAGjC,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC;;;;;;qBAChB,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC;;;AAA3C,mBAAK;;;;;AAEL,mBAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC;;;AAGpC,qBAAO,GAAG,OAAO,CAAC,KAAK,CAAC,OAAO,IAAI,UAAU,CAAC,QAAQ,CAAC,OAAO;;AAElE,sBAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,CAAC;AACjD,sBAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;;;qBAEtB,IAAI,EAAE;;;;;;;;KACb;;;;;OAAA;CACF;;AAEM,SAAS,QAAQ,QAAe;MAAb,UAAU,SAAV,UAAU;;AAClC;wDAAO,yBAA2C,IAAI;UAA9B,OAAO,SAAP,OAAO;UAAE,QAAQ,SAAR,QAAQ;UAAE,IAAI,SAAJ,IAAI;;;;;;AAE7C,sBAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,IAAI,EAAE,CAAC;;AAEpC,sBAAQ,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;;;qBAEpB,IAAI,EAAE;;;;;;;;KACb;;;;;OAAA;CACF","file":"common.js","sourcesContent":["\"use strict\";\n\nexport function showSchema({collection}) {\n  return async function ({request, response, params}, next) {\n\n    response.body = response.body || {};\n\n    var schema = collection.schema;\n\n    response.body.schema = {\n      name: schema.name,\n      description: schema.description,\n      properties: schema.properties,\n      relations: schema.relations\n    };\n\n    await next();\n  }\n}\n\nexport function showCount({collection}) {\n  return async function ({request, response, params}, next) {\n\n    response.body = response.body || {};\n\n    response.body.collectionCount = await collection.count();\n\n    await next();\n  }\n}\n\nexport function showPagesCount({collection}) {\n  return async function ({request, response, params}, next) {\n\n    var query = request.query || {};\n\n    response.body = response.body || {};\n\n    var count;\n    if(query.hasOwnProperty(\"where\")){\n      count = await collection.count(query.where);\n    }else{\n      count = response.body.collectionCount;\n    }\n\n    var perPage = request.query.perPage || collection.defaults.perPage;\n\n    response.body.pages = Math.ceil(count / perPage);\n    response.body.count = count;\n\n    await next();\n  }\n}\n\nexport function showUser({collection}) {\n  return async function ({request, response, user}, next) {\n\n    response.body = response.body || {};\n\n    response.body.user = user;\n\n    await next();\n  }\n}\n"]}