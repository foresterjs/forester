{"version":3,"sources":["../../lib/data-sources/tingo.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;;AAEb,IAAI,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC;;IAE7B,iBAAiB;AAErB,WAFI,iBAAiB,CAET,OAAO,EAAE;0BAFjB,iBAAiB;;AAGnB,QAAI,CAAC,EAAE,GAAG,IAAI,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;GACjD;;eAJG,iBAAiB;;;2EAMF,cAAc;;;;;;;;;;;;;;;;;;;4EAInB,cAAc;;;yEAA6C,EAAE;;YAA3C,IAAI,QAAJ,IAAI;YAAE,OAAO,QAAP,OAAO;YAAE,KAAK,QAAL,KAAK;YAAE,OAAO,QAAP,OAAO;YAAE,MAAM,QAAN,MAAM;;;;;kDAE5D,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACtC,sBAAI,MAAM,CAAC;;AAEX,sBAAI,KAAK,EAAE;AACT,0BAAM,GAAG,MAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;mBACvF,MAAM;AACL,0BAAM,GAAG,MAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,IAAI,EAAE,CAAC;mBACpD;;AAED,sBAAI,OAAO,EAAE;AACX,0BAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC;mBACtD;;AAED,sBAAI,IAAI,IAAI,OAAO,EAAE;AACnB,wBAAI,IAAI,GAAI,OAAO,IAAI,IAAI,GAAG,CAAC,CAAA,AAAC,AAAC,CAAC;;AAElC,0BAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACtB,0BAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;mBACnB;;AAED,wBAAM,CAAC,OAAO,CAAC,UAAU,GAAG,EAAE,IAAI,EAAE;AAClC,wBAAI,CAAC,GAAG,EACN,OAAO,CAAC,iBAAiB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,KAE1C,MAAM,CAAC,KAAK,CAAC,CAAC;mBACjB,CAAC,CAAC;iBACJ,CAAC;;;;;;;;;;;;;;;;;4EAIO,cAAc,EAAE,GAAG;;;;;;;qBAExB,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC;;;;;kDAEb,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;;AAEtC,qBAAG,GAAG,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE;AAC1B,2BAAO,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAA;mBAC5B,CAAC,CAAC;;AAEH,yBAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,EAAC,GAAG,EAAE,EAAC,GAAG,EAAE,GAAG,EAAC,EAAC,EAAE,UAAU,GAAG,EAAE,IAAI,EAAE;AAC9E,wBAAI,CAAC,GAAG,EAAE;AACR,6BAAO,CAAC,iBAAiB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;qBAC3C,MAAM;AACL,4BAAM,CAAC,KAAK,CAAC,CAAC;qBACf;mBACF,CAAC,CAAC;iBACJ,CAAC;;;kDAIK,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;;AAEtC,sBAAI,EAAE,GAAG,GAAG,CAAC;AACb,yBAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,EAAC,GAAG,EAAE,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAC,EAAE,UAAU,GAAG,EAAE,IAAI,EAAE;AAC/F,wBAAI,CAAC,GAAG,EAAE;AACR,6BAAO,CAAC,AAAC,IAAI,KAAK,IAAI,GAAI,KAAK,GAAG,iBAAiB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;qBACrE,MAAM;AACL,4BAAM,CAAC,KAAK,CAAC,CAAC;qBACf;mBACF,CAAC,CAAC;iBACJ,CAAC;;;;;;;;;;;;;;;;;4EAKO,cAAc,EAAE,IAAI;;;;;;;kDAExB,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACtC,yBAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,UAAU,GAAG,EAAE,MAAM,EAAE;AACrE,wBAAI,CAAC,GAAG,EACN,OAAO,CAAC,iBAAiB,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,KAE5C,MAAM,CAAC,KAAK,CAAC,CAAC;mBACjB,CAAC,CAAC;iBACJ,CAAC;;;;;;;;;;;;;;;;;4EAIS,cAAc,EAAE,EAAE,EAAE,IAAI;;;;;;;kDAE5B,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;;AAEtC,yBAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,aAAa,CAC9C,CAAC,EAAC,GAAG,EAAE,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAC,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,EAAC,IAAI,EAAE,IAAI,EAAC,EAAE,EAAC,KAAK,EAAE,IAAI,EAAC,EAC5E,UAAU,GAAG,EAAE,GAAG,EAAE;AAClB,wBAAI,CAAC,GAAG,EAAE;AACR,6BAAO,CAAC,iBAAiB,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;qBAC1C,MAAM;AACL,4BAAM,CAAC,KAAK,CAAC,CAAC;qBACf;mBACF,CAAC,CAAC;iBACN,CAAC;;;;;;;;;;;;;;;;;4EAIU,cAAc,EAAE,GAAG;;;;;;;qBAE3B,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC;;;;;kDAEb,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;;AAEtC,qBAAG,GAAG,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE;AAC1B,2BAAO,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAA;mBAC5B,CAAC,CAAC;;AAEH,yBAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,EAAC,GAAG,EAAE,GAAG,EAAC,EAAC,EAAE,UAAU,GAAG,EAAE,IAAI,EAAE;AAChF,wBAAI,CAAC,GAAG,EAAE;AACR,6BAAO,CAAC,IAAI,CAAC,CAAC;qBACf,MAAM;AACL,4BAAM,CAAC,KAAK,CAAC,CAAC;qBACf;mBACF,CAAC,CAAC;iBACJ,CAAC;;;kDAIK,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;;AAEtC,sBAAI,EAAE,GAAG,GAAG,CAAC;AACb,yBAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAC,EAAE,UAAU,GAAG,EAAE,IAAI,EAAE;AAC9F,wBAAI,CAAC,GAAG,EAAE;AACR,6BAAO,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC;qBACrB,MAAM;AACL,4BAAM,CAAC,KAAK,CAAC,CAAC;qBACf;mBACF,CAAC,CAAC;iBACJ,CAAC;;;;;;;;;;;;;;;;;4EAKO,cAAc,EAAE,EAAE;;;;;;;kDACtB,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACtC,yBAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,EAAC,KAAK,EAAE,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAC,EAAE,UAAU,GAAG,EAAE,IAAI,EAAE;AACjG,wBAAI,CAAC,GAAG,EACN,OAAO,CAAC,IAAI,KAAK,IAAI,CAAC,CAAC,KAEvB,MAAM,CAAC,KAAK,CAAC,CAAC;mBACjB,CAAC,CAAC;iBACJ,CAAC;;;;;;;;;;;;;;;;;4EAGQ,cAAc,EAAE,KAAK;;;;;;;kDACxB,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACtC,yBAAK,EAAE,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,UAAU,GAAG,EAAE,IAAI,EAAE;AACnE,wBAAI,CAAC,GAAG,EACN,OAAO,CAAC,IAAI,CAAC,CAAA,KAEb,MAAM,CAAC,KAAK,CAAC,CAAC;mBACjB,CAAC,CAAC;iBACJ,CAAC;;;;;;;;;;;;;;;;iCAIgB,OAAO,EAAE;;AAE3B,UAAI,UAAU,GAAG;AACf,WAAG,EAAE,CAAC;AACN,YAAI,EAAE,CAAC,CAAC;OACT,CAAC;;AAEF,UAAI,MAAM,GAAG,EAAE,CAAC;;AAEhB,WAAK,IAAI,KAAK,IAAI,OAAO,EAAE;AACzB,YAAI,KAAK,GAAG,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;AACvC,YAAI,CAAC,KAAK,EAAE,MAAM,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC;;AAEtD,cAAM,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC;OAEvB;;AAED,aAAO,MAAM,CAAC;KACf;;;+BAEiB,KAAK,EAAE;AACvB,aAAO,KAAK,CAAC;KACd;;;6BAEe,IAAI,EAAE;AACpB,UAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;AACvB,eAAO,IAAI,CAAC,GAAG,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;OAC7C;;AAED,UAAI,GAAG,GAAG,IAAI,CAAC;AACf,SAAG,CAAC,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;AAC5B,aAAO,GAAG,CAAC,GAAG,CAAC;AACf,aAAO,GAAG,CAAC;KACZ;;;SAxMG,iBAAiB;;;AA4MvB,MAAM,CAAC,OAAO,GAAG,iBAAiB,CAAC","file":"tingo.js","sourcesContent":["'use strict';\n\nvar tingodb = require('tingodb')();\n\nclass DataSourceTingoDB {\n\n  constructor(options) {\n    this.db = new tingodb.Db(options.path, options);\n  }\n\n  async updateSchema(collectionName) {\n\n  }\n\n  async findAll(collectionName, { page, perPage, where, orderBy, fields} = {}) {\n\n    return new Promise((resolve, reject) => {\n      var cursor;\n\n      if (where) {\n        cursor = this.db.collection(collectionName).find(DataSourceTingoDB.mongoWhere(where));\n      } else {\n        cursor = this.db.collection(collectionName).find();\n      }\n\n      if (orderBy) {\n        cursor.sort(DataSourceTingoDB.mongoOrderBy(orderBy));\n      }\n\n      if (page && perPage) {\n        var skip = (perPage * (page - 1));\n\n        cursor.limit(perPage);\n        cursor.skip(skip);\n      }\n\n      cursor.toArray(function (err, docs) {\n        if (!err)\n          resolve(DataSourceTingoDB.unwrapId(docs));\n        else\n          reject(false);\n      });\n    });\n\n  }\n\n  async pick(collectionName, ids) {\n\n    if (Array.isArray(ids)) {\n\n      return new Promise((resolve, reject) => {\n\n        ids = ids.map(function (id) {\n          return tingodb.ObjectID(id)\n        });\n\n        this.db.collection(collectionName).find({_id: {$in: ids}}, function (err, data) {\n          if (!err) {\n            resolve(DataSourceTingoDB.unwrapId(data));\n          } else {\n            reject(false);\n          }\n        });\n      });\n\n    } else {\n\n      return new Promise((resolve, reject) => {\n\n        var id = ids;\n        this.db.collection(collectionName).findOne({_id: new tingodb.ObjectID(id)}, function (err, data) {\n          if (!err) {\n            resolve((data === null) ? false : DataSourceTingoDB.unwrapId(data));\n          } else {\n            reject(false);\n          }\n        });\n      });\n\n    }\n  }\n\n  async create(collectionName, data) {\n\n    return new Promise((resolve, reject) => {\n      this.db.collection(collectionName).insert(data, function (err, result) {\n        if (!err)\n          resolve(DataSourceTingoDB.unwrapId(result));\n        else\n          reject(false);\n      });\n    });\n\n  }\n\n  async update(collectionName, id, data) {\n\n    return new Promise((resolve, reject) => {\n\n      this.db.collection(collectionName).findAndModify(\n        [{_id: new tingodb.ObjectID(id)}], [['_id', 1]], {$set: data}, {'new': true},\n        function (err, doc) {\n          if (!err) {\n            resolve(DataSourceTingoDB.unwrapId(doc));\n          } else {\n            reject(false);\n          }\n        });\n    })\n\n  }\n\n  async destroy(collectionName, ids) {\n\n    if (Array.isArray(ids)) {\n\n      return new Promise((resolve, reject) => {\n\n        ids = ids.map(function (id) {\n          return tingodb.ObjectID(id)\n        });\n\n        this.db.collection(collectionName).remove({_id: {$in: ids}}, function (err, data) {\n          if (!err) {\n            resolve(true);\n          } else {\n            reject(false);\n          }\n        });\n      });\n\n    } else {\n\n      return new Promise((resolve, reject) => {\n\n        var id = ids;\n        this.db.collection(collectionName).remove({_id: new tingodb.ObjectID(id)}, function (err, data) {\n          if (!err) {\n            resolve(data === 1);\n          } else {\n            reject(false);\n          }\n        });\n      });\n\n    }\n  }\n\n  async exists(collectionName, id) {\n    return new Promise((resolve, reject) => {\n      this.db.collection(collectionName).findOne({'_id': new tingodb.ObjectID(id)}, function (err, data) {\n        if (!err)\n          resolve(data !== null);\n        else\n          reject(false);\n      });\n    });\n  }\n\n  async count(collectionName, where) {\n    return new Promise((resolve, reject) => {\n      this.db.collection(collectionName).count(where, function (err, data) {\n        if (!err)\n          resolve(data)\n        else\n          reject(false);\n      });\n    });\n  }\n\n\n  static mongoOrderBy(orderBy) {\n\n    var orderByMap = {\n      ASC: 1,\n      DESC: -1\n    };\n\n    var result = {};\n\n    for (var field in orderBy) {\n      var value = orderByMap[orderBy[field]];\n      if (!value) throw new Error('orderBy not recognized');\n\n      result[field] = value;\n\n    }\n\n    return result;\n  }\n\n  static mongoWhere(where) {\n    return where;\n  }\n\n  static unwrapId(docs) {\n    if (Array.isArray(docs)) {\n      return docs.map(DataSourceTingoDB.unwrapId);\n    }\n\n    var doc = docs;\n    doc.id = doc._id.toString();\n    delete doc._id;\n    return doc;\n  }\n\n}\n\nmodule.exports = DataSourceTingoDB;\n"]}